---
title: "Negligible heritability of language and manual laterality: a twin study"
author: "DVM Bishop"
date: "10/05/2018"
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE,message = FALSE,warning=FALSE)

require(yarrr)
require(stargazer) #Hlavac, Marek (2018). stargazer: Well-Formatted Regression and Summary Statistics Tables.
# R package version 5.2.1. https://CRAN.R-project.org/package=stargazer 
require(tidyverse)
require(OpenMx)
require(MASS)
mxOption(NULL, 'Default optimizer', 'NPSOL')
source('http://ibg.colorado.edu/cdrom2016/verhulst/Power/powerFun.R')
#see http://www.people.vcu.edu/~bverhulst/power/powerScript.R
```
```{r readdata, echo=FALSE}
#Read data before any text as need to refer to Ns etc computed here.
#Version of redcap output from 9 May has zygosity for one pair where it had been wrongly coded 9
mydir<-"/Users/dorothybishop/Dropbox/ERCadvanced/project twin kids/Project_files/"
myfile<-"TwinsData_DATA_2018-05-09_1021.csv"
mydata<-read.csv(paste0(mydir,"Data/",myfile),stringsAsFactors = FALSE)
w<-which(colnames(mydata)=='include')  #this relates to exclusion criteria re IQ,autism etc : not used here
colnames(mydata)[w]<-'myinclude' #to avoid problems with having 'include' as column name
```

```{r converthanddata,echo=FALSE}
#-------------------------------------------------------
# Created jittered values of QHP and EHP for plots
#-------------------------------------------------------
mydata$qhp_handedness<-mydata$qhp_freq_r+.5*mydata$qhp_freq_e
mydata$ehp_jitter <-jitter(mydata$ehp_handedness,2) #last term 2 gives greater jitter than default
mydata$qhp_jitter <-jitter(mydata$qhp_handedness,2)

#-------------------------------------------------------
# Create a variable that has categorical laterality for 2 handedness tasks and LI
#-------------------------------------------------------
mydata$lat3<-3
w<-which(mydata$qhp_handedness<11&mydata$ehp_handedness<6&mydata$lateralised_category<1)
mydata$lat3[w]<-2 #reversed laterality
w<-which(mydata$qhp_handedness>10.5&mydata$ehp_handedness>5.5&mydata$lateralised_category>0)
mydata$lat3[w]<-1 #typical laterality
mydata$taskssum<-0
w<-which(mydata$qhp_handedness>10)
mydata$taskssum[w]<-mydata$taskssum[w]+1 

#also just do a count of N tasks in conventional direction - taskssum
w<-which(mydata$ehp_handedness>5)
mydata$taskssum[w]<-mydata$taskssum[w]+1 
w<-which(mydata$lateralised_category>0)
mydata$taskssum[w]<-mydata$taskssum[w]+1 

w<-which(is.na(mydata$lateralised_category))
mydata$lat3[w]<-NA
mydata$taskssum[w]<-NA
mydata$taskssum_jitter<-jitter(mydata$taskssum,2)

```

```{r selectcols, echo=FALSE}
#----------------------------------------------------------
# Produce data frame of selected columns 
#----------------------------------------------------------
data.short<-filter(mydata,zygosity<9)
data.short<-dplyr::select(mydata,record_id,fam_id,age_at_test,female,zygosity,myinclude,twin,n_trials, laterality_index,qhp_handedness,ehp_handedness,lang_probs,lateralised_category,lat3,ehp_jitter,qhp_jitter,taskssum,taskssum_jitter)
#identify cases to exclude because of less than 12 trials on doppler
w<-c(which(data.short$n_trials<12),which(is.na(data.short$n_trials)))
data.short$doppexcl <- 0
data.short$doppexcl[w] <-1

```

```{r doublentry, echo=FALSE}
#-------------------------------------------------------
# Create double entry file with twin 1 and 2 aligned
# Assumes twins from pair are in adjacent rows
#-------------------------------------------------------
nrec<-nrow(data.short)
nvar<-ncol(data.short)
nuorder2<-c(seq(from=2,to=nrec,by=2),seq(from=1,to=nrec,by=2)) #odd nums
nuorder1<-c(seq(from=1,to=nrec,by=2),seq(from=2,to=nrec,by=2)) #even nums
doubledata<-cbind(data.short[nuorder1,],data.short[nuorder2,])
range2<-(nvar+1):(nvar*2)
colnames(doubledata)[range2]<-paste0(colnames(doubledata)[1:nvar],2)

#recode all DZ as 2, MZ as one
doubledata$MZDZ<-2
w<-which(doubledata$zygosity==1)
doubledata$MZDZ[w]<-1

#add a colour code to identify whether gender  MM or MF or FF
doubledata$gender2 <-1+doubledata$female+doubledata$female2
#check all aligned
check<-sum(doubledata$fam_id-doubledata$fam_id2)
if(check>0) {print('Twins not aligned!!!')}
```

```{r exclusions, echo=FALSE}
#-------------------------------------------------------
# Exclude those with unusable data - either twin
#-------------------------------------------------------


doubledata$doppout <-doubledata$doppexcl+doubledata$doppexcl2
w<-which(doubledata$doppout==2)
doubledata$doppout[w]<-1

#remove case of extreme LI, defined as +/-10
w<-c(which(abs(doubledata$laterality_index)>12),which(abs(doubledata$laterality_index2)>12))
doubledata$doppout[w]<-1 #picks up case with LI of -15,which is more than 5 SD from mean!

doubledata2<-filter(doubledata,doppout<1)


#unit of analysis is twin pair excluded, so need to divide by 2 as one row per twin

Npairwithhand <- nrow(doubledata)/2
Npairwithdopp<-nrow(doubledata2)/2
```

##Abstract

## Introduction
Lateralisation of language and motor function in humans are traits with two notable features: First, there is a pronunced population bias to one side - to the left for lateralisation of language in the brain, and to the right for handedness; Second there is individual variation in the extent of bias, with some individuals showing a reversal of the typical pattern, and others showing little or no asymmetry.

Other primates show some indications of lateralised functions, but humans are quite distinctive in their strong population bias to right-handedness. It is often assumed that evolution of manual laterality is related to development of a complex and lateralised language faculty in humans, but the biological origins of the population bias are not well understood for either trait. 

Twins provide a useful natural experiment for estimating the contribution of genetic variation to individual differences in a trait. The twin method uses comparisons of similarity of identical (monozygotic or MZ) twins versus non-identical (dizygotic or DZ twins) to derive estimates of the relative contributions of genetic variants, environment shared by the twins, and other twin-specific influences (including chance) on individual variation in a trait. This is best understood intuitively by imagining a variety of hypothetical situations. In the first, the trait is solely determined by random chance: in that case, two members of a twin pair (A and B) would be no more similar than two unrelated people, and in a sample of twins, the correlation between twin A and twin B would be zero, regardless of zygosity. In the second situation, the trait is solely determined by an environmental factor common to both twins, such as home environment. In that case, there would be perfect correlation between the traits in twin A and twin B. In the third situation, the trait is determined solely by genes: because MZ twins are genetically identical, the correlation between two members of a twin pair will be 1, but for DZ twins, who on average have 50% of their segregating genes in common, the correlation will be .5. In practice, our goal is not to attribute variation in the observed trait (phenotype) to one cause or the other, but rather to assume their effects are additive and estimate their relative contribution. We specify that the total variance in a trait, v is equal to a^2^ + c^2^ + e^2^, where a is additive genetic variance, c is shared (common) environment and e is random, nonshared environment. Similarity between pairs of MZ twins is the sum of genetic and shared environmental influences, a^2^ + c^2^, and similarity between pairs of DZ twins is .5 a^2^ + c^2^, so we can estimate heritability (a^2^) as twice the difference in correlation between MZ and DZ twins, and then obtain the values for c^2^ and e^2^ by simple algebra (Sham, 1998).

Twin studies of manual laterality have shown that, contrary to conventional wisdom, individual differences in handedness are largely determined by chance, with genetic variation playing a relatively minor role. A meta-analysis of twin studies estimated heritability of around .23, with shared environment effect of zero. Studies of language laterality are far less numerous, because of the difficulty and expense of studying large numbers of twins. Table 1 summarises results from studies that have looked at structural and functional asymmetries in twins, and one can see that the estimates of heritability are again low, and in keeping with those previously reported for handedness.

To do: Table 1 - summary of studies of structural/functional asymmetry

As far as we are aware, to date there has not been a twin study that uses a direct, functional measure of language lateralisation. We report genetic analysis from a study of `r Npairwithdopp` twin pairs, showing that, consistent with previous studies of handedness and brain asymmetry, chance (or environmental factors not shared between twins) plays the major role in determining individual differences.

Our sample consists of twin children recruited for a study of the genetic bases of developmental language disorder (DLD), for whom language lateralisation was assessed using functional transcranial Doppler ultrasound (fTCD). Data from these children have previously been reported in the context of an analysis focusing on relationships between cerebral lateralisation and language functioning (Wilson & Bishop, 2018). That analysis found no difference in language laterality between children with language disorders and those with typical language development, although the reliability of the laterality index obtained with this measure was good (split-half reliability for odd and even trials = .84). Furthermore, comparison with a previous study using the same methods confirmed that language lateralisation in twins did not differ from that observed in single-born children. This sample provides a useful opportunity to fill a gap in the literature with an analysis comparing MZ and DZ twins in order to estimate the relative contribution of genetic and non-genetic variation to individual differences in language laterality.  

##Methods
###Participants
For a detailed account of selection of participants, see Wilson and Bishop (2018). In brief, we recruited `r Npairwithhand ` pairs of twins aged 6 years 0 months to 11 years 11 months, using a sampling approach with the aim of including around 75% twin pairs where one or both had language or literacy difficulties. Handedness assessments were completed for all children, and language laterality assessment (see below) was available for `r Npairwithdopp` pairs. The breakdown of the sample by zygosity and gender is shown in Table 2.

```{r table2, echo=FALSE}
#--------------------------------------------------------------
doubledata$zygosex<-10*doubledata$zygosity+doubledata$female
w<-which(doubledata$zygosex==31)
doubledata$zygosex[w] <-30
doubledata$zygosex<-as.factor(doubledata$zygosex)
levels(doubledata$zygosex) <- c('MZ female','MZ male','DZ female','DZ male','DZ male/female')
tab2 <- table(doubledata$zygosex,doubledata$doppout)
tab2f<-data.frame(cbind(tab2[1:5],tab2[1:5],tab2[6:10]))
tab2f[,1]<-tab2f[,2]+tab2f[,3]
tab2f[,1:2]<-tab2f[,1:2]/2
tab2f<-tab2f[,1:2]
row.names(tab2f)<-levels(doubledata$zygosex)
colnames(tab2f)<-c('All','With fTCD')
stargazer(tab2f,type='text',title='Table 2: N twin pairs by zygosity and sex',summary=FALSE)
#--------------------------------------------------------------

```
###Zygosity determination
DNA was available for 191 twin pairs who were compared across 250,875 SNPs. All gave unambiguous zygosity signals on Identity by State (IBS), i.e., the proportion of SNPs for which any given twin pair share genotypes: this was either close to 1.0 (MZ) or close to 0.5 (DZ). For twins with missing or inadequate DNA samples we relied on parental report of zygosity.

###Laterality assessment
1. Handedness

Hand preference was assessed using a hand preference battery based on items from the Edinburgh Handedness Inventory (EHI) (Oldfield, 1971), modified to exclude one item (striking a match) deemed unsuitable for children. The child was asked to demonstrate each of ten actions: writing, drawing, throwing a ball, using scissors, using toothbrush, cutting with a knife, using a spoon, using a broom (upper hand), taking the lid off a box, and dealing cards. One point was awarded for exclusive right hand use, zero points for left hand use, and half a point if both hands were used, giving a score ranging from zero to ten.

Strength of hand preference was assessed using the Quantification of Hand Preference (QHP) task (Bishop et al., 1996), which measures the tendency to continue to use the preferred hand when cards are picked up from different spatial locations. Three cards are set out in each of seven positions extending at 30 degree intervals from the left to the right of the childâ€™s midline. The child is not told that handedness is being assessed, and treats the task as a picture-name matching game, where they have to pick up the named card and put it in the box. The same quasi-random order of positions was used for all children, starting with a card at the midline and continuing until the child had picked up and placed  three cards at each of seven locations, to give a total of 21 trials. For each card, two points were awarded for right-handed use, zero points for left-handed use, and one point if the card was transferred from one hand to another in the course of placing it in the box.

2. Language laterality

Language laterality was assessed using functional transcranial Doppler ultrasound (fTCD) while the child described short episodes from a story presented as an animation. A video demonstration of this procedure is available from Bishop et al (2010). Transcranial Doppler ultrasound is used in medical contexts to assess the integrity of the cerebral blood vessels.  For assessing cerebral lateralisation, left and right ultrasound probes are attached to a headset so as to detect lateralised changes in blood flow in the middle cerebral arteries. 

On each trial, the child silently views a 12 s clip from a cartoon that included sounds but no speech. A response cue appears when the video clip finishes to indicate the start of a 10 s period during which the child is asked to describe what happened in the cartoon. A second cue then indicates that the child should stop talking and relax. This paradigm has previously been found to have good validity and reliability (Bishop et al. 2009).

A maximum of 30 trials was administered, depending on the child's tolerance of the procedure. The child's verbal responses were recorded and subsequently transcribed, and the examiner noted behaviour during the procedure.  Trials were excluded if the child either spoke during a silent period, or failed to talk during the 'talk' period: these need to be omitted because they invalidate the trial, which involves comparing the period when the child talks with a baseline period when no talking occurs. 

The analysis of the animation task data consists of a standard sequence of processing steps, following original work by Deppe  et al (1997). We used a custom script written in R () for data processing. This included an initial step of identifying trials where there was very brief signal dropout (affecting one datapoint) and interpolate the mean value in such cases. Trials with more prolonged signal dropout were discarded. After these preliminary steps, heart cycle integration was applied to remove the heartbeat, followed by signal normalisation, artefact rejection, epoching and baseline correction.The averaged left and right velocity plots were subtracted to give a difference waveform, and the peak difference (maximum or minimum) was located within a period of interest, predefined as x to x seconds after the cue to speak. The laterality index (LI) is then computed as the mean amplitude of mean blood flow velocity difference in a 2 sec window centred on the peak difference value. 

Following Groen et al (2012) we excluded data from children who had fewer than 12 accepted trials, as the LI is likely to be unreliable when based on such a small amount of data. In addition, data were excluded for one twin pair where one child's laterality index was more than 5 SD from the mean. 

The standard error of the LI for an individual was computed by considering the size of LI at the same peak latency across all trials. This makes it possible to consider whether the LI is significantly different from zero. Where this was the case, laterality can be categorised as left or right, and where the LI was not significantly different from zero, the laterality is coded as bilateral. Note that coding of bilateral laterality can result if data are merely noisy.

3. Consistency of manual/language laterality.

Prominent genetic theories by Annett () and McManus () have proposed that observed distributions of handedness are the result of a mixture of two underlying genotypes: one that shows a population bias and the other that has handedness randomly determined. If the typical bias affected both manual and language laterality, this should lead to  a typical pattern of right-handedness and left-brainedness for language; the greater the departure from this pattern, the greater the likelihood that the individual has the atypical, unbiased genotype. To evaluate this idea, individuals were categorised as typical or atypical on each measure, and an overall measure derived consisting of the number of tasks with typical laterality (R for handedness and L for language). For the language measure, left-lateralisation was coded when the 95% confidence interval around the LI did not include zero. For the handedness measure, R-handedness was coded when more actions/reaches were performed with the R than with the L.

## Procedure  
(This section is copied from Wilson & Bishop, 2018). Ethical approval was obtained for the study in 2011 from the Berkshire NHS Research Ethics Committee (reference 11/SC/0096), and data collection started in August of that year, finishing in October 2016. Where families had expressed interest in the study, they were interviewed by telephone to assess whether the children were likely to meet inclusion criteria, and an appointment was made to see the twins at home or at school, depending on parental preference. Families were widely dispersed around the UK, including Northern Ireland, Scotland, Wales and England, so testing was scheduled where possible to minimise travel. During the course of recruitment, which lasted for a period of five years, a total of eight research assistants as well as the senior author were involved in assessing children. In some cases, two testers worked together, each seeing one twin, and in others a single tester saw both children sequentially. The assessment was conducted in a single session lasting between 2-3 hours per child, with breaks where needed.

```{r powertab, echo=FALSE}
#---------------------------------------------------------------------------------------
# DVMB version of powerFun, with just AE in model
# Used to see how low a value of a2 is detected in AE model with this sample size
#---------------------------------------------------------------------------------------
powertable <-data.frame(matrix(NA,nrow=20,ncol=5)) #initialise table to hold results
myaa<-vector() #blank vector: will hold smallest value of aa with lower CI > 0
colnames(powertable)<-c('MZ/DZ Npairs','true.aa','est.aa','se.est','lowerCI')
thisrow<-0
for (myn in 1:2){ #estimate for both sample sizes
for (myadd in seq(5,50, by=5)){ #estimate for a2 values from .05 to .5 in steps of .5
  thisrow<-thisrow+1
aa=myadd/100 # 
Nmz=tab2f[1,myn]+tab2f[2,myn] #take Ns from previous tab2f
Ndz=tab2f[3,myn]+tab2f[4,myn]+tab2f[5,myn]


nv <- 1 #N variables
ntv <- nv*2 #N columns (twins)

ee <- sqrt(1 - aa^2)
AA <- aa^2
EE <- ee^2

mzMat <- matrix(c(AA + EE, AA, AA, AA + EE),2)
dzMat <- matrix(c(AA + EE, .5*AA, .5*AA, AA + EE),2)

mzData <- mvrnorm(Nmz , mu = c(0,0), mzMat, empirical = T)
dzData <- mvrnorm(Ndz , mu = c(0,0), dzMat, empirical = T)

selVars <- paste("t", 1:2, sep = "")
colnames(mzData) <- colnames(dzData) <- selVars

MZdata  <-  mxData(mzData, type="raw" )
DZdata  <-  mxData(dzData, type="raw" )


a <-  mxMatrix( type="Lower", nrow=nv, ncol=nv, free=TRUE, values=.6, label="a11", name="a" )
e <-  mxMatrix( type="Lower", nrow=nv, ncol=nv, free=TRUE, values=.6, label="e11", name="e" )

A <-  mxAlgebra( expression=a %*% t(a), name="A" )
E <-  mxAlgebra( expression=e %*% t(e), name="E" )

Mean    <-  mxMatrix( type="Full", nrow=1, ncol=nv, free=TRUE, values= 0, label="mean", name="Mean" )
expMean <-  mxAlgebra( expression= cbind(Mean,Mean), name="expMean")

expCovMZ <- mxAlgebra( expression= rbind  ( cbind(A+E , A),cbind(A   , A+E)), name="expCovMZ" )
expCovDZ <- mxAlgebra( expression= rbind  ( cbind(A+E     , 0.5%x%A),cbind(0.5%x%A , A+E)),  name="expCovDZ" ) 

obs <-  list(a,e,A,E,Mean,expMean,expCovMZ,expCovDZ)

fun <- mxFitFunctionML()
mzExp <- mxExpectationNormal(covariance="expCovMZ", means="expMean", dimnames=selVars )
dzExp <- mxExpectationNormal(covariance="expCovDZ", means="expMean", dimnames=selVars )

MZ <- mxModel("MZ", obs, MZdata, fun, mzExp)
DZ <- mxModel("DZ", obs, DZdata, fun, dzExp)

aeFun <- mxFitFunctionMultigroup(c("MZ","DZ"))
ae <- mxModel("AE", MZ, DZ, fun, aeFun)

aeFit <- mxRun(ae, silent = T)
summary(aeFit)

pars <- round(cbind(aeFit$output$estimate, aeFit$output$standardErrors), 3)
colnames(pars) <- c("Estimates", "Std. Err.")

powertable[thisrow,1]<-paste0(Nmz,'/',Ndz)
powertable[thisrow,2]<-aa
powertable[thisrow,3:4]<-pars[1,1:2]
powertable[thisrow,5]<-round(pars[1,1]-1.96*pars[1,2],3)
#Find the value of a2 where lower CI is just above 0
if (powertable[thisrow,5]<0){thisaa<-thisrow}
}
  myaa<-c(myaa,powertable[(thisaa+1),2])
}
#myaa holds 2 values: one for larger and one for smaller sample size
#These correspond to smallest values of aa detectable as different from zero with this sample size

```
## Data analysis
1. Power analysis

As noted above, the usual approach to twin analysis is ACE decomposition, typically implemented using structural equation modeling with maximum likelihood estimates (Rijsdijk & Sham, 2002). Large samples are needed to accurately estimate additive genetic (a^2^), shared environmental (c^2^) influences, both of which lead to positive covariance between two members of both MZ and DZ pairs: they are distinguished by the fact that genetic influence leads to greater covariance for MZ and DZ twins. In the context of laterality, however, estimates of shared environmental influences are negligible in adequately powered twin studies, and it is safe to ignore the c^2^ term. This simplifies the analysis, making it possible to detect genetic effects with smaller samples. A power analysis using a modified version of the powerFun function in OpenMx showed that for the larger sample of twins for whom handedness data were available, there is power to detect heritability, a^2^, of `r round(myaa[1]^2,2)` or greater, and for the smaller sample with language laterality data, an effect of `r round(myaa[2]^2,2)` or greater is detectable.
(Note to self: these values seem way too low! - need to check with verhulst method involving noncentrality parameter)

2. AE modeling



## Results
Scatterplots showing the association of the laterality indices between two members of a twin pair showed no indication of any association (see Figure 1). 


```{r scatterplot,echo=FALSE}
#------------------------------------------------------------------------
#scatterplot and correlation by zygosity as MZ/DZ: do for LI and handedness measures
#------------------------------------------------------------------------

par(mfrow=c(1,2),oma = c(0, 0, 2, 0)) #oma sets margins to allow for overall header
task<-c('Edinburgh Handedness Inventory','QHP','Laterality Index (fTCD)','taskssum')
pchcode <- c(3,9,5) #symbols to correspond to MM, FF and MF pairs
tasklims <- matrix(c(-1,11,5,3,4,
                     -1,22,10,5,6,
                     -6,11,0,6,-5,
                     -1,4,1.5,3,4),nrow=4,byrow=TRUE) #axis limits for 3 tasks, then bilateralpoint, then x and y position for correl coeff
ehicols<-which(names(doubledata)%in%c('ehp_jitter','ehp_jitter2'))
qhpcols<-which(names(doubledata)%in%c('qhp_jitter','qhp_jitter2'))
licols<-which(names(doubledata)%in%c('laterality_index','laterality_index2'))
taskcols<-which(names(doubledata)%in%c('taskssum_jitter','taskssum_jitter2'))
mycols<-rbind(ehicols,qhpcols,licols,taskcols)
for (j in 1:4){ #2 handedness measures and LI from Doppler
  plotdata<-doubledata
  if(j>2){plotdata<-doubledata2}
for (i in 1:2){
  mymain='MZ: '
  if (i==2){mymain='DZ: '}
  tempdat <-filter(plotdata,MZDZ==i)
  #correlation from double entry gives ICC
  rlat<-cor(tempdat[,mycols[j,1]],tempdat[,mycols[j,2]])
  mysub<-paste0('r = ',toString(round(rlat,3))) #text with correl coeff to 3 places
  tempdat1<-filter(tempdat,twin==1) #because of double entry, just use twin1
  #------------------------------------------------------------------------------
  #for opposite sex twins, reorganise so that male is twin 1 and female twin 2
  #------------------------------------------------------------------------------
 #This is just to help visualise the plot: reassignment is not retained for later   analysis
   if (i==2){
    w <- which(tempdat1$zygosity==3 & tempdat1$female==1)
  tempbit <- tempdat1[w,mycols[j,1]]
  tempdat1[w,mycols[j,1]]<-tempdat1[w,mycols[j,2]]
    tempdat1[w,mycols[j,2]]<-tempbit
  }
   #------------------------------------------------------------------------------
  #Now plot MZ and DZ values for twin 1 and twin 2
  #------------------------------------------------------------------------------

  mymain=paste0(mymain,'N = ',nrow(tempdat1),' pairs')
  plot(tempdat1[,mycols[j,1]],tempdat1[,mycols[j,2]],xlim=tasklims[j,1:2],ylim=tasklims[j,1:2],pch=pchcode[tempdat$gender2],
       xlab='Twin 1',ylab='Twin 2',main=mymain,cex.lab=1.2)
  text(tasklims[j,4],tasklims[j,5],mysub,col='red',font=2)
  abline(h=tasklims[j,3],col=4,lty=2)
  abline(v=tasklims[j,3],col=4,lty=2)
  mtext(task[j], outer = TRUE, cex = 1.5)
}
}
# After re-ordering as above,for the opposite sex group, male is twin 1 and female is twin 2. Need to explain that in the legend as well as use of jitter.
#dev.off()
```

```{r AEmodel, echo=FALSE}
#---------------------------------------------------------------
#Try fitting AE model, despite low correlations.
# Predict it won't fit because of zero DZ correlation - only compatible with no genetic effect! 
# Surprisingly, fit seems OK.
nv <- 1 #N variables
ntv <- nv*2 #N columns (twins)
aatable <-data.frame(matrix(NA,nrow=3,ncol=6))
colnames(aatable)<-c('Measure','N MZ','N DZ','a','a.SE','a^2')
mxcols <-matrix(c('ehp_handedness','ehp_handedness2','qhp_handedness','qhp_handedness2','laterality_index','laterality_index2'),nrow=3,byrow=TRUE)
for (mytask in 1:3){
selVars <- mxcols[mytask,1:2]
latcols<-which(names(doubledata)%in%selVars)
rowrange<-1:(nrow(doubledata)/2)
mymz <- filter(doubledata[rowrange,],MZDZ==1)
mydz <- filter(doubledata[rowrange,],MZDZ==2)
if(mytask==3)
{mymz<-filter(mymz,doppout==0)
mydz<-filter(mydz,doppout==0)
}
MZdata  <-  mxData(scale(mymz[,latcols]), type="raw" )
DZdata  <-  mxData(scale(mydz[,latcols]), type="raw" )

a <-  mxMatrix( type="Lower", nrow=nv, ncol=nv, free=TRUE, values=.6, label="a11", name="a" )
e <-  mxMatrix( type="Lower", nrow=nv, ncol=nv, free=TRUE, values=.6, label="e11", name="e" )

A <-  mxAlgebra( expression=a %*% t(a), name="A" )
E <-  mxAlgebra( expression=e %*% t(e), name="E" )

Mean    <-  mxMatrix( type="Full", nrow=1, ncol=nv, free=TRUE, values= 0, label="mean", name="Mean" )
expMean <-  mxAlgebra( expression= cbind(Mean,Mean), name="expMean")

expCovMZ <- mxAlgebra( expression= rbind  ( cbind(A+E , A),cbind(A   , A+E)), name="expCovMZ" )
expCovDZ <- mxAlgebra( expression= rbind  ( cbind(A+E     , 0.5%x%A),cbind(0.5%x%A , A+E)),  name="expCovDZ" ) 

obs <-  list(a,e,A,E,Mean,expMean,expCovMZ,expCovDZ)

fun <- mxFitFunctionML()
mzExp <- mxExpectationNormal(covariance="expCovMZ", means="expMean", dimnames=selVars )
dzExp <- mxExpectationNormal(covariance="expCovDZ", means="expMean", dimnames=selVars )

MZ <- mxModel("MZ", obs, MZdata, fun, mzExp)
DZ <- mxModel("DZ", obs, DZdata, fun, dzExp)

aeFun <- mxFitFunctionMultigroup(c("MZ","DZ"))
ae <- mxModel("AE", MZ, DZ, fun, aeFun)

aeFit <- mxRun(ae, silent = T)
summary(aeFit)

pars <- round(cbind(aeFit$output$estimate, aeFit$output$standardErrors), 3)
colnames(pars) <- c("Estimates", "Std. Err.")
aatable[mytask,1]<-mxcols[mytask,1]
aatable[mytask,2]<-nrow(mymz)
aatable[mytask,3]<-nrow(mydz)
aatable[mytask,4]<-pars[1,1]
aatable[mytask,5]<-pars[1,2]
aatable[mytask,6]<-round(pars[1,1]^2,2)
}
stargazer(aatable,type='text',title='Table 3: Heritability estimates for different measures',summary=FALSE)

#NB all tasks have been scaled; skew in the handedness measures has not been accounted for
```
##Session information
```{r sessinfo}
sessionInfo()
```
